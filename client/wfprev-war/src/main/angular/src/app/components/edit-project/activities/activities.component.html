<div class="fiscals-container">
    <mat-expansion-panel [expanded] = 'true' class="expansion-panel">
        <mat-expansion-panel-header>
            <div class="header-container">
                <span class="project-title">Activities</span>
                <button class="dropdown-button" mat-icon-button (click)="$event.stopPropagation()">
                    <img class="action-icon" alt="actions" src="/assets/add-button.svg">
                  <span>Add Activity</span>
                </button>
            </div>
        </mat-expansion-panel-header>
        <div *ngIf="activities?.length">
            <div *ngFor="let activity of activities; let i = index">
                <mat-expansion-panel class="expansion-panel">
                    <mat-expansion-panel-header>
                        <div class="activity-title">
                            <div>
                                {{getActivityTitle(i)}}
                            </div>
                            <div class="update-date">
                                Last Updated: {{getLastUpdated(i)}}
                            </div>
                        </div>
                    </mat-expansion-panel-header>
                    <form class="form-grid" *ngIf="activityForms[i]" [formGroup]="activityForms[i]">
                        <div class="form-item">
                            <label>Results Reportable</label>
                            <div class="toggle-container">
                                <mat-slide-toggle 
                                  id="isResultsReportableInd" 
                                  formControlName="isResultsReportableInd">
                                </mat-slide-toggle>
                                <span class="toggle-label">
                                  {{ activityForms[i].value?.isResultsReportableInd ? 'Yes' : 'No' }}
                                </span>
                            </div>
                        </div>
                        <div class="form-item">
                            <label>Completed Hectares(To Date)</label>
                            <input type="number" id="completedAreaHa" formControlName="completedAreaHa"/>
                        </div>
                        <div class="form-item">
                            <label>Reported Spend</label>
                            <input type="number" id="reportedSpendAmount" formControlName="reportedSpendAmount"/>
                        </div>
                        <div class="form-item">
                            <label>Activity Status</label>
                            <div class="toggle-container">
                                <mat-slide-toggle 
                                    id="activityStatusCode" 
                                    [checked]="activityForms[i].value?.activityStatusCode === 'COMPLETED'"
                                    (change)="toggleActivityStatus(i)">
                                </mat-slide-toggle>
                                <span class="toggle-label">
                                  Complete
                                </span>
                            </div>
                        </div>

                        <div class="form-item">
                            <label>Activity Base</label>
                            <select id="silvicultureBaseGuid" formControlName="silvicultureBaseGuid">
                                <option value="" >Select</option>
                            </select>
                        </div>
                        <div class="form-item">
                            <label>Method</label>
                            <select id="silvicultureMethodeGuid" formControlName="silvicultureMethodGuid">
                                <option value="" >Select</option>
                            </select>
                        </div>
                        <div class="form-item">
                            <label>Technique</label>
                            <select id="silvicultureTechniqueGuid" formControlName="silvicultureTechniqueGuid">
                                <option value="" >Select</option>
                            </select>
                        </div>
                        <div class="form-item">
                            <label>Activity Name<span class="required">*</span></label>
                            <input type="text" id="activityName" formControlName="activityName"/>
                        </div>


                        <div class="form-item full-width">
                            <label>Activity Description<span class="required">*</span></label>
                            <textarea 
                              id="activityDescription" 
                              formControlName="activityDescription" 
                              rows="1" cols="30"
                            >
                            </textarea>
                        </div>
                        <div class="form-item five-columns">
                            <label>Activity Start and End <span class="required">*</span></label>
                            <div class="date-range-container">
                                <mat-form-field>
                                    <mat-date-range-input [rangePicker]="picker" formGroupName="activityDateRange">
                                        <input matStartDate formControlName="activityStartDate" placeholder="YYYY-MM-DD">
                                        <input matEndDate formControlName="activityEndDate" placeholder="YYYY-MM-DD">
                                    </mat-date-range-input>
                                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                                    <mat-date-range-picker #picker panelClass="custom-overlay"></mat-date-range-picker>
                                </mat-form-field>
                            </div>
                        </div>

                        <div class="form-item five-columns">
                            <label>Planned Hectares</label>
                            <input type="number" id="plannedTreatmentAreaHa" formControlName="plannedTreatmentAreaHa" min="0"/>
                        </div>

                        <div class="form-item five-columns">
                            <label>Planned Spend</label>
                            <input type="number" id="plannedSpendAmount" formControlName="plannedSpendAmount" min="0"/>
                        </div>

                        <div class="form-item five-columns">
                            <label>Contract Phase</label>
                            <select id="contractPhaseCode" formControlName="contractPhaseCode">
                                <option value="" >Select</option>
                            </select>
                        </div>

                        <div class="form-item five-columns">
                            <label>Funding Source Code</label>
                            <select id="activityFundingSourceGuid" formControlName="activityFundingSourceGuid">
                                <option value="" >Select</option>
                            </select>
                        </div>
                    </form>
                </mat-expansion-panel>
            </div>
        </div>
    </mat-expansion-panel>
</div>