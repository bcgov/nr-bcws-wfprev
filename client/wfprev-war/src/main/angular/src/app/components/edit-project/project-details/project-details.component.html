<div class="details-container">
  <form [formGroup]="detailsForm" class="form-grid" *ngIf="projectDetail">
    <div class="form-item">
      <wfprev-select-field
        [label]="'Project Type'"
        [required]="true"
        [control]="getControl('projectTypeCode')"
        [options]="projectTypeCode"
        [optionValueField]="'projectTypeCode'"
        [optionLabelField]="'description'"
        [tooltip]="getCodeDescription(CodeTableKeys.PROJECT_TYPE_CODE)"
        id="projectTypeCode"
        placeholder="Select"
      />
    </div>

    <div class="form-item funding-stream">
      <label>Funding Stream</label>
      <input type="text" readonly />
    </div>

    <div class="form-item">
      <wfprev-select-field
        [label]="'Business/Program Area'"
        [required]="true"
        [control]="getControl('programAreaGuid')"
        [options]="programAreaCode"
        [optionValueField]="'programAreaGuid'"
        [optionLabelField]="'programAreaName'"
        [tooltip]="getCodeDescription(CodeTableKeys.PROGRAM_AREA_GUID)"
        id="programAreaGuid"
      />
    </div>

    <div class="form-item">
      <wfprev-input-field
        [id]="'closestCommunityName'"
        [label]="'Closest Community'"
        [placeholder]="'Begin Typing'"
        [control]="getControl('closestCommunityName')"
        [tooltip]="getControl('closestCommunityName')?.value"
        [required]="true"
        [errorMessages]="{ maxlength: messages.maxLengthExceeded }"
      ></wfprev-input-field>

    </div>

    <div class="form-item">
      <wfprev-select-field
        [label]="'Forest Region'"
        [required]="true"
        [control]="getControl('forestRegionOrgUnitId')"
        [options]="forestRegionCode"
        [optionValueField]="'orgUnitId'"
        [optionLabelField]="'orgUnitName'"
        [tooltip]="getCodeDescription(CodeTableKeys.FOREST_REGION_ORG_UNIT_ID)"
        id="forestRegionOrgUnitId"
      />
    </div>

    <div class="form-item">
      <wfprev-select-field
        [label]="'Forest District'"
        [required]="false"
        [control]="getControl('forestDistrictOrgUnitId')"
        [options]="forestDistrictCode"
        [optionValueField]="'orgUnitId'"
        [optionLabelField]="'orgUnitName'"
        [tooltip]="getCodeDescription(CodeTableKeys.FOREST_DISTRICT_ORG_UNIT_ID)"
        [placeholder]="'Select'"
        id="forestDistrictOrgUnitId"
      />
    </div>

    <div class="form-item">
      <wfprev-select-field
        [label]="'BC Parks Region'"
        [required]="false"
        [control]="getControl('bcParksRegionOrgUnitId')"
        [options]="bcParksRegionCode"
        [optionValueField]="'orgUnitId'"
        [optionLabelField]="'orgUnitName'"
        [tooltip]="getCodeDescription(CodeTableKeys.BC_PARKS_REGION_ORG_UNIT_ID)"
        [placeholder]="'Select'"
        id="bcParksRegionOrgUnitId"
      />
    </div>

    <div class="form-item">
      <wfprev-select-field
        [label]="'BC Parks Section'"
        [required]="false"
        [control]="getControl('bcParksSectionOrgUnitId')"
        [options]="bcParksSectionCode"
        [optionValueField]="'orgUnitId'"
        [optionLabelField]="'orgUnitName'"
        [tooltip]="getCodeDescription(CodeTableKeys.BC_PARKS_SECTION_ORG_UNIT_ID)"
        [placeholder]="'Select'"
        id="bcParksSectionOrgUnitId"
      />
    </div>

    <div class="form-item">
      <wfprev-select-field
        [label]="'BCWS Fire Centre'"
        [required]="true"
        [control]="getControl('fireCentreId')"
        [options]="fireCentres"
        [optionValueField]="'id'"
        [optionLabelField]="'label'"
        [tooltip]="getCodeDescription(CodeTableKeys.FIRE_CENTRE_ID)"
        id="fireCentreId"
      />
    </div>

    <div class="form-item">
      <wfprev-input-field
        [id]="'projectLead'"
        [label]="'Project Lead'"
        [placeholder]="'Begin Typing'"
        [control]="getControl('projectLead')"
        [tooltip]="getControl('projectLead')?.value"
        [required]="true"
        [errorMessages]="{ maxlength: messages.maxLengthExceeded }"
      />
    </div>

    <div class="form-item">
      <wfprev-input-field
        [id]="'projectLeadEmailAddress'"
        [label]="'Project Lead Email'"
        [placeholder]="'Begin Typing'"
        [control]="getControl('projectLeadEmailAddress')"
        [tooltip]="getControl('projectLeadEmailAddress')?.value"
        [type]="'email'"
        [errorMessages]="{
          email: messages.invalidEmail,
          maxlength: messages.maxLengthExceeded
        }"
      />
    </div>

    <div class="form-item">
      <wfprev-input-field
        [id]="'siteUnitName'"
        [label]="'Planning Unit'"
        [placeholder]="'Begin Typing'"
        [control]="getControl('siteUnitName')"
        [tooltip]="getControl('siteUnitName')?.value"
        [errorMessages]="{ maxlength: messages.maxLengthExceeded }"
      />
    </div>

    <div class="objective-group">
      <div class="form-item objective-field">
        <wfprev-select-field
          [label]="'Primary Objective'"
          [required]="true"
          [control]="getControl('primaryObjectiveTypeCode')"
          [options]="objectiveTypeCode"
          [optionValueField]="'objectiveTypeCode'"
          [optionLabelField]="'description'"
          [tooltip]="getCodeDescription(CodeTableKeys.PRIMARY_OBJECTIVE_TYPE_CODE)"
          id="primaryObjectiveTypeCode"
        />
      </div>

      <div class="form-item objective-field">
        <wfprev-select-field
          [label]="'Secondary Objective'"
          [required]="false"
          [control]="getControl('secondaryObjectiveTypeCode')"
          [options]="objectiveTypeCode"
          [optionValueField]="'objectiveTypeCode'"
          [optionLabelField]="'description'"
          [tooltip]="getCodeDescription(CodeTableKeys.SECONDARY_OBJECTIVE_TYPE_CODE)"
          id="secondaryObjectiveTypeCode"
          [placeholder]="'Select'"
        />
      </div>

      <div class="form-item secondary-rationale">
        <label for="secondaryObjectiveRationale">Secondary Objective Rationale</label>
        <textarea id="secondaryObjectiveRationale" formControlName="secondaryObjectiveRationale"
          placeholder="Begin Typing" rows="1" cdkTextareaAutosize cdkAutosizeMinRows="1" cdkAutosizeMaxRows="10"
          [matTooltip]="detailsForm.get('secondaryObjectiveRationale')?.value"></textarea>
        <div class="error"
          *ngIf="detailsForm.get('secondaryObjectiveRationale')?.hasError('maxlength') && detailsForm.get('secondaryObjectiveRationale')?.touched">
          {{messages.maxLengthExceeded}}
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="button-row">
        <button class="secondary" (click)="onCancel()" [disabled]="!detailsForm.dirty">Cancel</button>
        <button type="button" (click)="onSave()" [disabled]="!detailsForm.valid || !detailsForm.dirty"
          class="primary">Save
        </button>
      </div>
    </div>
  </form>
</div>
<div class="description-map-section">
  <div class="project-left-section">
    <mat-expansion-panel #panel="matExpansionPanel">
      <mat-expansion-panel-header class="expansion-panel-header">
        <mat-panel-title class="project-title">
          <wfprev-expansion-indicator [isExpanded]="panel.expanded"></wfprev-expansion-indicator>
          <span>Project Description</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <div class="project-form">
        <form class="project-description">
          <textarea [(ngModel)]="projectDescription" name="projectDescription" rows="1" class="editable-description"
            cdkTextareaAutosize cdkAutosizeMinRows="1" cdkAutosizeMaxRows="10" placeholder="Begin Typing"
            (ngModelChange)="onProjectDescriptionChange($event)"></textarea>
          <div class="project-description-footer">
            <div class="button-row">
              <button class="secondary" (click)="onCancelProjectDescription()"
                [disabled]="!isProjectDescriptionDirty">Cancel</button>
              <button class="primary" [disabled]="!isProjectDescriptionDirty" (click)="onSaveProjectDescription()">
                Save
              </button>
            </div>
          </div>
        </form>
      </div>


    </mat-expansion-panel>
    <wfprev-fiscal-year-projects></wfprev-fiscal-year-projects>
  </div>

  <div class="map-section">
    <div id="map"></div>
    <div class="latlong-section">
      <form>
        <label for="coordinates">Latitude/Longitude:</label>
        <div class="input-group">
          <input type="text" id="coordinates" [(ngModel)]="latLong" name="latLong"
            placeholder="Enter Latitude/Longitude (e.g., 56.9835° N, 127.3656° W)"
            (ngModelChange)="onLatLongChange($event)" />
          <button type="button" (click)="onSaveLatLong()" [disabled]="!isLatLongDirty" class="primary">Save
          </button>
        </div>
      </form>
    </div>
    <wfprev-project-files (filesUpdated)="onFilesUpdated()" [projectGuid]="projectGuid"></wfprev-project-files>
  </div>
</div>