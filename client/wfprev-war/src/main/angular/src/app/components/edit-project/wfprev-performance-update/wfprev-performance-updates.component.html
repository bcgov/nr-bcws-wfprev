<div class="performance-update-container">
    <mat-expansion-panel [expanded]='true' class="expansion-panel" #performanceUpdatesPanels>
        <mat-expansion-panel-header>
            <div class="header-container">
                <wfprev-expansion-indicator
                    [isExpanded]="performanceUpdatesPanels.expanded"></wfprev-expansion-indicator>
                <span class="project-title">Performance Updates</span>
                <wfprev-icon-button [text]="'New Update'" [icon]="'/assets/add-button.svg'" [alt]="'add-update'"
                    [iconSize]="19" (clicked)="openDialog()">
                </wfprev-icon-button>
            </div>
        </mat-expansion-panel-header>
        @if(updates.length > 0) {
        @for (update of updates; track update.submittedTimestamp; let i = $index) {
        <mat-expansion-panel [expanded]='i === 0' class="expansion-panel" #updatePanel>
            <mat-expansion-panel-header class="performance-update-header">
                <wfprev-expansion-indicator [isExpanded]="updatePanel.expanded"></wfprev-expansion-indicator>
                <div class="performance-update-title">
                    <div>
                        <p class="project-title"><b>Date: {{update.submittedTimestamp}}</b></p>
                    </div>
                </div>
                <div class="content-status-indicators">
                    <span>Reporting Period: {{update.reportingPeriod}}</span>
                    @if (update.progressStatusCode === delayed.value) {
                    <span>
                        <img alt="status" class="status-icon" src="/assets/progress-status-delayed.svg">
                        {{delayed.description}}
                    </span>
                    }
                    @if (update.progressStatusCode === onTrack.value) {
                    <span>
                        <img alt="status" class="status-icon" src="/assets/progress-status-ontrack.svg">
                        {{onTrack.description}}
                    </span>
                    }
                    @if (update.progressStatusCode === deffered.value) {
                    <span>
                        <img alt="status" class="status-icon" src="/assets/progress-status-ontrack.svg">
                        {{deffered.description}}
                    </span>
                    }
                    @if (update.progressStatusCode === cancelled.value) {
                    <span>
                        <img alt="status" class="status-icon" src="/assets/progress-status-ontrack.svg">
                        {{cancelled.description}}
                    </span>
                    }
                    @if(update.forecastStatus === ForecastStatus.ChangedDecreased){
                    <span>
                        <img alt="status" class="status-icon" src="/assets/budget-change.svg">
                        Forecast Decreased
                    </span>
                    }
                    @if(update.forecastStatus === ForecastStatus.ChangedIncreased){
                    <span>
                        <img alt="status" class="status-icon" src="/assets/budget-change.svg">
                        Forecast Increased
                    </span>
                    }
                </div>
                @if(update.updateGeneralStatus === UpdateGeneralStatus.InProgress) {
                <div class="status-indicators">
                    <span class="status-tag">
                        <img alt="status" class="status-icon" src="/assets/in-progress-icon-only.svg">
                        In progress
                    </span>
                </div>
                }
                @if(update.updateGeneralStatus === UpdateGeneralStatus.Prepared) {
                <div class="status-indicators">
                    <span class="status-tag">
                        <img alt="status" class="status-icon" src="/assets/prepared-icon.svg">
                        Prepared
                    </span>
                </div>
                }
            </mat-expansion-panel-header>
            <div class="form-grid">
                <div class="general-updates-container">
                    <div class="updates-header">
                        <div class="updates-header-title">
                            <p>General Updates (Successes, Challenges, Progress)</p>
                        </div>
                        <div class="submitted-by">
                            <p>Submited by: {{update.submittedBy}}</p>
                        </div>
                    </div>
                    <div>
                        <p>{{update.generalUpdateComment}}</p>
                    </div>
                </div>
                <div class="budget-adjustment-container">
                    <div class="budget-adjustment-header">
                        <div class="budget-adjustment-title">
                            <span>Budget adjustment</span>
                        </div>
                        <div class="budget-adjustment-lable">
                            @if(update.forecastStatus === ForecastStatus.ChangedDecreased){
                            <span>
                                <img alt="status" class="status-icon" src="/assets/budget-change.svg">
                                Forecast Decreased
                            </span>
                            }

                            @if(update.forecastStatus === ForecastStatus.ChangedIncreased){
                            <span>
                                <img alt="status" class="status-icon" src="/assets/budget-change.svg">
                                Forecast Increased
                            </span>
                            }
                        </div>
                    </div>
                    <div class="budget-adjustment-ditails">
                        <div class="budget-adjustment-item">
                            <p class="budget-title">Revised Forecast Amount</p>
                            <p>{{update.forecastAmount | currency}}</p>
                        </div>
                        <div class="budget-adjustment-item">
                            <p class="budget-title">Forecast Adjustment Amount</p>
                            <p>{{update.forecastAdjustmentAmount | currency}}</p>
                        </div>
                        <div class="budget-adjustment-item">
                            <p class="budget-title">Forecast Adjustment Rationale</p>
                            <p>{{update.forecastAdjustmentRationale}}</p>
                        </div>
                    </div>
                </div>
                <div class="budget-breackdown-container">
                    <div class="budget-breakdown-header">
                        <p>Budget Risk Breakdown</p>
                    </div>
                    <div class="budget-breackdown-table">
                        <div class="budget-breackdown-row">
                            <div class="budget-breackdown-cell1">
                                <img alt="status" class="status-icon" src="/assets/high-risk.svg">
                                <p>High risk</p>
                            </div>
                            <div class="budget-breackdown-cell2">
                                <p>{{update.budgetHighRiskAmount | currency}}</p>
                            </div>
                            <div>
                                <p>{{update.budgetHighRiskRationale}}</p>
                            </div>
                        </div>
                        <div class="budget-breackdown-row">
                            <div class="budget-breackdown-cell1">
                                <img alt="status" class="status-icon" src="/assets/medium-risk.svg">
                                <p>Medium risk</p>
                            </div>
                            <div class="budget-breackdown-cell2">
                                <p>{{update.budgetMediumRiskAmount | currency}}</p>
                            </div>
                            <div>
                                <p>{{update.budgetMediumRiskRationale}}</p>
                            </div>
                        </div>
                        <div class="budget-breackdown-row">
                            <div class="budget-breackdown-cell1">
                                <img alt="status" class="status-icon" src="/assets/low-risk.svg">
                                <p>Low risk</p>
                            </div>
                            <div class="budget-breackdown-cell2">
                                <p>{{update.budgetLowRiskAmount | currency}}</p>
                            </div>
                            <div>
                                <p>{{update.budgetLowRiskRationale}}</p>
                            </div>
                        </div>
                        <div class="budget-breackdown-row">
                            <div class="budget-breackdown-cell1">
                                <img alt="status" class="status-icon" src="/assets/none-risk.svg">
                                <p>Complete</p>
                            </div>
                            <div class="budget-breackdown-cell2">
                                <p>{{update.budgetCompletedAmount | currency}}</p>
                            </div>
                            <div>
                                <p>{{update.budgetCompletedDescription}}</p>
                            </div>
                        </div>
                        <div class="budget-breackdown-last-row">
                            <div class="budget-breackdown-cell1">
                                <p>Total:</p>
                            </div>
                            <div class="budget-breackdown-cell2">
                                <p>{{update.totalAmount | currency}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </mat-expansion-panel>
        }
        }
    </mat-expansion-panel>
</div>